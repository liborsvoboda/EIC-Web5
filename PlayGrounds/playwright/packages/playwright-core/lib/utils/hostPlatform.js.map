{"version":3,"file":"hostPlatform.js","names":["_os","_interopRequireDefault","require","_linuxUtils","e","__esModule","default","calculatePlatform","platform","os","ver","release","split","map","a","parseInt","macVersion","LAST_STABLE_MAC_MAJOR_VERSION","Math","min","cpus","some","cpu","model","includes","hostPlatform","isOfficiallySupportedPlatform","arch","archSuffix","distroInfo","getLinuxDistributionInfoSync","id","version","exports"],"sources":["../../src/utils/hostPlatform.ts"],"sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport os from 'os';\nimport { getLinuxDistributionInfoSync } from './linuxUtils';\n\nexport type HostPlatform = 'win64' |\n                           'mac10.13' |\n                           'mac10.14' |\n                           'mac10.15' |\n                           'mac11' | 'mac11-arm64' |\n                           'mac12' | 'mac12-arm64' |\n                           'mac13' | 'mac13-arm64' |\n                           'mac14' | 'mac14-arm64' |\n                           'ubuntu18.04-x64' | 'ubuntu18.04-arm64' |\n                           'ubuntu20.04-x64' | 'ubuntu20.04-arm64' |\n                           'ubuntu22.04-x64' | 'ubuntu22.04-arm64' |\n                           'ubuntu24.04-x64' | 'ubuntu24.04-arm64' |\n                           'debian11-x64' | 'debian11-arm64' |\n                           'debian12-x64' | 'debian12-arm64' |\n                           '<unknown>';\n\nfunction calculatePlatform(): { hostPlatform: HostPlatform, isOfficiallySupportedPlatform: boolean } {\n  const platform = os.platform();\n  if (platform === 'darwin') {\n    const ver = os.release().split('.').map((a: string) => parseInt(a, 10));\n    let macVersion = '';\n    if (ver[0] < 18) {\n      // Everything before 10.14 is considered 10.13.\n      macVersion = 'mac10.13';\n    } else if (ver[0] === 18) {\n      macVersion = 'mac10.14';\n    } else if (ver[0] === 19) {\n      macVersion = 'mac10.15';\n    } else {\n      // ver[0] >= 20\n      const LAST_STABLE_MAC_MAJOR_VERSION = 14;\n      // Best-effort support for MacOS beta versions.\n      macVersion = 'mac' + Math.min(ver[0] - 9, LAST_STABLE_MAC_MAJOR_VERSION);\n      // BigSur is the first version that might run on Apple Silicon.\n      if (os.cpus().some(cpu => cpu.model.includes('Apple')))\n        macVersion += '-arm64';\n    }\n    return { hostPlatform: macVersion as HostPlatform, isOfficiallySupportedPlatform: true };\n  }\n  if (platform === 'linux') {\n    if (!['x64', 'arm64'].includes(os.arch()))\n      return { hostPlatform: '<unknown>', isOfficiallySupportedPlatform: false };\n\n    const archSuffix = '-' + os.arch();\n    const distroInfo = getLinuxDistributionInfoSync();\n\n    // Pop!_OS is ubuntu-based and has the same versions.\n    // KDE Neon is ubuntu-based and has the same versions.\n    // TUXEDO OS is ubuntu-based and has the same versions.\n    if (distroInfo?.id === 'ubuntu' || distroInfo?.id === 'pop' || distroInfo?.id === 'neon' || distroInfo?.id === 'tuxedo') {\n      const isOfficiallySupportedPlatform = distroInfo?.id === 'ubuntu';\n      if (parseInt(distroInfo.version, 10) <= 19)\n        return { hostPlatform: ('ubuntu18.04' + archSuffix) as HostPlatform, isOfficiallySupportedPlatform: false };\n      if (parseInt(distroInfo.version, 10) <= 21)\n        return { hostPlatform: ('ubuntu20.04' + archSuffix) as HostPlatform, isOfficiallySupportedPlatform };\n      if (parseInt(distroInfo.version, 10) <= 22)\n        return { hostPlatform: ('ubuntu22.04' + archSuffix) as HostPlatform, isOfficiallySupportedPlatform };\n      return { hostPlatform: ('ubuntu24.04' + archSuffix) as HostPlatform, isOfficiallySupportedPlatform };\n    }\n    // Linux Mint is ubuntu-based but does not have the same versions\n    if (distroInfo?.id === 'linuxmint') {\n      if (parseInt(distroInfo.version, 10) <= 20)\n        return { hostPlatform: ('ubuntu20.04' + archSuffix) as HostPlatform, isOfficiallySupportedPlatform: false };\n      return { hostPlatform: ('ubuntu22.04' + archSuffix) as HostPlatform, isOfficiallySupportedPlatform: false };\n    }\n    if (distroInfo?.id === 'debian' || distroInfo?.id === 'raspbian') {\n      const isOfficiallySupportedPlatform = distroInfo?.id === 'debian';\n      if (distroInfo?.version === '11')\n        return { hostPlatform: ('debian11' + archSuffix) as HostPlatform, isOfficiallySupportedPlatform };\n      if (distroInfo?.version === '12')\n        return { hostPlatform: ('debian12' + archSuffix) as HostPlatform, isOfficiallySupportedPlatform };\n      // use most recent supported release for 'debian testing' and 'unstable'.\n      // they never include a numeric version entry in /etc/os-release.\n      if (distroInfo?.version === '')\n        return { hostPlatform: ('debian12' + archSuffix) as HostPlatform, isOfficiallySupportedPlatform };\n    }\n    return { hostPlatform: ('ubuntu20.04' + archSuffix) as HostPlatform, isOfficiallySupportedPlatform: false };\n  }\n  if (platform === 'win32')\n    return { hostPlatform: 'win64', isOfficiallySupportedPlatform: true };\n  return { hostPlatform: '<unknown>', isOfficiallySupportedPlatform: false };\n}\n\nexport const { hostPlatform, isOfficiallySupportedPlatform } = calculatePlatform();\n"],"mappings":"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","ignoreList":[]}