{"version":3,"file":"zipFile.js","names":["_zipBundle","require","ZipFile","constructor","fileName","_fileName","_zipFile","_entries","Map","_openedPromise","_open","Promise","fulfill","reject","yauzl","open","autoClose","e","z","on","entry","set","entries","keys","read","entryPath","get","Error","resolve","openReadStream","error","readStream","buffers","data","push","Buffer","concat","close","_this$_zipFile","exports"],"sources":["../../src/utils/zipFile.ts"],"sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { yauzl } from '../zipBundle';\nimport type { UnzipFile, Entry } from '../zipBundle';\n\nexport class ZipFile {\n  private _fileName: string;\n  private _zipFile: UnzipFile | undefined;\n  private _entries = new Map<string, Entry>();\n  private _openedPromise: Promise<void>;\n\n  constructor(fileName: string) {\n    this._fileName = fileName;\n    this._openedPromise = this._open();\n  }\n\n  private async _open() {\n    await new Promise<UnzipFile>((fulfill, reject) => {\n      yauzl.open(this._fileName, { autoClose: false }, (e, z) => {\n        if (e) {\n          reject(e);\n          return;\n        }\n        this._zipFile = z;\n        this._zipFile!.on('entry', (entry: Entry) => {\n          this._entries.set(entry.fileName, entry);\n        });\n        this._zipFile!.on('end', fulfill);\n      });\n    });\n  }\n\n  async entries(): Promise<string[]> {\n    await this._openedPromise;\n    return [...this._entries.keys()];\n  }\n\n  async read(entryPath: string): Promise<Buffer> {\n    await this._openedPromise;\n    const entry = this._entries.get(entryPath)!;\n    if (!entry)\n      throw new Error(`${entryPath} not found in file ${this._fileName}`);\n\n    return new Promise((resolve, reject) => {\n      this._zipFile!.openReadStream(entry, (error, readStream) => {\n        if (error || !readStream) {\n          reject(error || 'Entry not found');\n          return;\n        }\n\n        const buffers: Buffer[] = [];\n        readStream.on('data', data => buffers.push(data));\n        readStream.on('end', () => resolve(Buffer.concat(buffers)));\n      });\n    });\n  }\n\n  close() {\n    this._zipFile?.close();\n  }\n}\n"],"mappings":";;;;;;AAgBA,IAAAA,UAAA,GAAAC,OAAA;AAhBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAKO,MAAMC,OAAO,CAAC;EAMnBC,WAAWA,CAACC,QAAgB,EAAE;IAAA,KALtBC,SAAS;IAAA,KACTC,QAAQ;IAAA,KACRC,QAAQ,GAAG,IAAIC,GAAG,CAAgB,CAAC;IAAA,KACnCC,cAAc;IAGpB,IAAI,CAACJ,SAAS,GAAGD,QAAQ;IACzB,IAAI,CAACK,cAAc,GAAG,IAAI,CAACC,KAAK,CAAC,CAAC;EACpC;EAEA,MAAcA,KAAKA,CAAA,EAAG;IACpB,MAAM,IAAIC,OAAO,CAAY,CAACC,OAAO,EAAEC,MAAM,KAAK;MAChDC,gBAAK,CAACC,IAAI,CAAC,IAAI,CAACV,SAAS,EAAE;QAAEW,SAAS,EAAE;MAAM,CAAC,EAAE,CAACC,CAAC,EAAEC,CAAC,KAAK;QACzD,IAAID,CAAC,EAAE;UACLJ,MAAM,CAACI,CAAC,CAAC;UACT;QACF;QACA,IAAI,CAACX,QAAQ,GAAGY,CAAC;QACjB,IAAI,CAACZ,QAAQ,CAAEa,EAAE,CAAC,OAAO,EAAGC,KAAY,IAAK;UAC3C,IAAI,CAACb,QAAQ,CAACc,GAAG,CAACD,KAAK,CAAChB,QAAQ,EAAEgB,KAAK,CAAC;QAC1C,CAAC,CAAC;QACF,IAAI,CAACd,QAAQ,CAAEa,EAAE,CAAC,KAAK,EAAEP,OAAO,CAAC;MACnC,CAAC,CAAC;IACJ,CAAC,CAAC;EACJ;EAEA,MAAMU,OAAOA,CAAA,EAAsB;IACjC,MAAM,IAAI,CAACb,cAAc;IACzB,OAAO,CAAC,GAAG,IAAI,CAACF,QAAQ,CAACgB,IAAI,CAAC,CAAC,CAAC;EAClC;EAEA,MAAMC,IAAIA,CAACC,SAAiB,EAAmB;IAC7C,MAAM,IAAI,CAAChB,cAAc;IACzB,MAAMW,KAAK,GAAG,IAAI,CAACb,QAAQ,CAACmB,GAAG,CAACD,SAAS,CAAE;IAC3C,IAAI,CAACL,KAAK,EACR,MAAM,IAAIO,KAAK,CAAC,GAAGF,SAAS,sBAAsB,IAAI,CAACpB,SAAS,EAAE,CAAC;IAErE,OAAO,IAAIM,OAAO,CAAC,CAACiB,OAAO,EAAEf,MAAM,KAAK;MACtC,IAAI,CAACP,QAAQ,CAAEuB,cAAc,CAACT,KAAK,EAAE,CAACU,KAAK,EAAEC,UAAU,KAAK;QAC1D,IAAID,KAAK,IAAI,CAACC,UAAU,EAAE;UACxBlB,MAAM,CAACiB,KAAK,IAAI,iBAAiB,CAAC;UAClC;QACF;QAEA,MAAME,OAAiB,GAAG,EAAE;QAC5BD,UAAU,CAACZ,EAAE,CAAC,MAAM,EAAEc,IAAI,IAAID,OAAO,CAACE,IAAI,CAACD,IAAI,CAAC,CAAC;QACjDF,UAAU,CAACZ,EAAE,CAAC,KAAK,EAAE,MAAMS,OAAO,CAACO,MAAM,CAACC,MAAM,CAACJ,OAAO,CAAC,CAAC,CAAC;MAC7D,CAAC,CAAC;IACJ,CAAC,CAAC;EACJ;EAEAK,KAAKA,CAAA,EAAG;IAAA,IAAAC,cAAA;IACN,CAAAA,cAAA,OAAI,CAAChC,QAAQ,cAAAgC,cAAA,eAAbA,cAAA,CAAeD,KAAK,CAAC,CAAC;EACxB;AACF;AAACE,OAAA,CAAArC,OAAA,GAAAA,OAAA","ignoreList":[]}