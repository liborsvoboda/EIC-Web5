{"version":3,"file":"traceUtils.js","names":["serializeClientSideCallMetadata","metadatas","fileNames","Map","stacks","m","stack","length","frame","ordinal","get","file","size","set","stackFrame","line","column","function","push","id","files","keys"],"sources":["../../src/utils/traceUtils.ts"],"sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { ClientSideCallMetadata } from '@protocol/channels';\nimport type { SerializedClientSideCallMetadata, SerializedStack, SerializedStackFrame } from './isomorphic/traceUtils';\n\nexport function serializeClientSideCallMetadata(metadatas: ClientSideCallMetadata[]): SerializedClientSideCallMetadata {\n  const fileNames = new Map<string, number>();\n  const stacks: SerializedStack[] = [];\n  for (const m of metadatas) {\n    if (!m.stack || !m.stack.length)\n      continue;\n    const stack: SerializedStackFrame[] = [];\n    for (const frame of m.stack) {\n      let ordinal = fileNames.get(frame.file);\n      if (typeof ordinal !== 'number') {\n        ordinal = fileNames.size;\n        fileNames.set(frame.file, ordinal);\n      }\n      const stackFrame: SerializedStackFrame = [ordinal, frame.line || 0, frame.column || 0, frame.function || ''];\n      stack.push(stackFrame);\n    }\n    stacks.push([m.id, stack]);\n  }\n  return { files: [...fileNames.keys()], stacks };\n}\n"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAKO,SAASA,+BAA+BA,CAACC,SAAmC,EAAoC;EACrH,MAAMC,SAAS,GAAG,IAAIC,GAAG,CAAiB,CAAC;EAC3C,MAAMC,MAAyB,GAAG,EAAE;EACpC,KAAK,MAAMC,CAAC,IAAIJ,SAAS,EAAE;IACzB,IAAI,CAACI,CAAC,CAACC,KAAK,IAAI,CAACD,CAAC,CAACC,KAAK,CAACC,MAAM,EAC7B;IACF,MAAMD,KAA6B,GAAG,EAAE;IACxC,KAAK,MAAME,KAAK,IAAIH,CAAC,CAACC,KAAK,EAAE;MAC3B,IAAIG,OAAO,GAAGP,SAAS,CAACQ,GAAG,CAACF,KAAK,CAACG,IAAI,CAAC;MACvC,IAAI,OAAOF,OAAO,KAAK,QAAQ,EAAE;QAC/BA,OAAO,GAAGP,SAAS,CAACU,IAAI;QACxBV,SAAS,CAACW,GAAG,CAACL,KAAK,CAACG,IAAI,EAAEF,OAAO,CAAC;MACpC;MACA,MAAMK,UAAgC,GAAG,CAACL,OAAO,EAAED,KAAK,CAACO,IAAI,IAAI,CAAC,EAAEP,KAAK,CAACQ,MAAM,IAAI,CAAC,EAAER,KAAK,CAACS,QAAQ,IAAI,EAAE,CAAC;MAC5GX,KAAK,CAACY,IAAI,CAACJ,UAAU,CAAC;IACxB;IACAV,MAAM,CAACc,IAAI,CAAC,CAACb,CAAC,CAACc,EAAE,EAAEb,KAAK,CAAC,CAAC;EAC5B;EACA,OAAO;IAAEc,KAAK,EAAE,CAAC,GAAGlB,SAAS,CAACmB,IAAI,CAAC,CAAC,CAAC;IAAEjB;EAAO,CAAC;AACjD","ignoreList":[]}