{"version":3,"file":"locatorParser.js","names":["_stringUtils","require","_locatorGenerators","_selectorParser","parseLocator","locator","testIdAttributeName","replace","_","group","toLowerCase","group1","group2","params","template","i","length","quote","isRegexEscaping","text","push","preferredQuote","map","p","filter","includes","selector","transform","countParams","matchAll","shiftParams","sub","ordinal","hasMatch","match","start","index","balance","end","prefix","substring","extraSymbol","paramsCountBeforeHas","hasTemplate","paramsCountInHas","hasParams","slice","hasSelector","JSON","stringify","paramsBeforeHas","paramsAfterHas","concat","parts","split","startsWith","nth","splice","t","param","suffix","escapeForAttributeSelector","RegExp","escapeForTextSelector","join","locatorOrSelectorAsSelector","language","parseSelector","e","locators","asLocators","undefined","digest","digestForComparison","some","candidate"],"sources":["../../../src/utils/isomorphic/locatorParser.ts"],"sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { escapeForAttributeSelector, escapeForTextSelector } from '../../utils/isomorphic/stringUtils';\nimport { asLocators } from './locatorGenerators';\nimport type { Language, Quote } from './locatorGenerators';\nimport { parseSelector } from './selectorParser';\n\ntype TemplateParams = { quote: string, text: string }[];\nfunction parseLocator(locator: string, testIdAttributeName: string): { selector: string, preferredQuote: Quote | undefined } {\n  locator = locator\n      .replace(/AriaRole\\s*\\.\\s*([\\w]+)/g, (_, group) => group.toLowerCase())\n      .replace(/(get_by_role|getByRole)\\s*\\(\\s*(?:[\"'`])([^'\"`]+)['\"`]/g, (_, group1, group2) => `${group1}(${group2.toLowerCase()}`);\n  const params: TemplateParams = [];\n  let template = '';\n  for (let i = 0; i < locator.length; ++i) {\n    const quote = locator[i];\n    if (quote !== '\"' && quote !== '\\'' && quote !== '`' && quote !== '/') {\n      template += quote;\n      continue;\n    }\n    const isRegexEscaping = locator[i - 1] === 'r' || locator[i] === '/';\n    ++i;\n    let text = '';\n    while (i < locator.length) {\n      if (locator[i] === '\\\\') {\n        if (isRegexEscaping) {\n          if (locator[i + 1] !== quote)\n            text += locator[i];\n          ++i;\n          text += locator[i];\n        } else {\n          ++i;\n          if (locator[i] === 'n')\n            text += '\\n';\n          else if (locator[i] === 'r')\n            text += '\\r';\n          else if (locator[i] === 't')\n            text += '\\t';\n          else\n            text += locator[i];\n        }\n        ++i;\n        continue;\n      }\n      if (locator[i] !== quote) {\n        text += locator[i++];\n        continue;\n      }\n      break;\n    }\n    params.push({ quote, text });\n    template += (quote === '/' ? 'r' : '') + '$' + params.length;\n  }\n\n  // Equalize languages.\n  template = template.toLowerCase()\n      .replace(/get_by_alt_text/g, 'getbyalttext')\n      .replace(/get_by_test_id/g, 'getbytestid')\n      .replace(/get_by_([\\w]+)/g, 'getby$1')\n      .replace(/has_not_text/g, 'hasnottext')\n      .replace(/has_text/g, 'hastext')\n      .replace(/has_not/g, 'hasnot')\n      .replace(/frame_locator/g, 'framelocator')\n      .replace(/[{}\\s]/g, '')\n      .replace(/new\\(\\)/g, '')\n      .replace(/new[\\w]+\\.[\\w]+options\\(\\)/g, '')\n      .replace(/\\.set/g, ',set')\n      .replace(/\\.or_\\(/g, 'or(') // Python has \"or_\" instead of \"or\".\n      .replace(/\\.and_\\(/g, 'and(') // Python has \"and_\" instead of \"and\".\n      .replace(/:/g, '=')\n      .replace(/,re\\.ignorecase/g, 'i')\n      .replace(/,pattern.case_insensitive/g, 'i')\n      .replace(/,regexoptions.ignorecase/g, 'i')\n      .replace(/re.compile\\(([^)]+)\\)/g, '$1') // Python has regex strings as r\"foo\"\n      .replace(/pattern.compile\\(([^)]+)\\)/g, 'r$1')\n      .replace(/newregex\\(([^)]+)\\)/g, 'r$1')\n      .replace(/string=/g, '=')\n      .replace(/regex=/g, '=')\n      .replace(/,,/g, ',');\n\n  const preferredQuote = params.map(p => p.quote).filter(quote => '\\'\"`'.includes(quote))[0] as Quote | undefined;\n  return { selector: transform(template, params, testIdAttributeName), preferredQuote };\n}\n\nfunction countParams(template: string) {\n  return [...template.matchAll(/\\$\\d+/g)].length;\n}\n\nfunction shiftParams(template: string, sub: number) {\n  return template.replace(/\\$(\\d+)/g, (_, ordinal) => `$${ordinal - sub}`);\n}\n\nfunction transform(template: string, params: TemplateParams, testIdAttributeName: string): string {\n  // Recursively handle filter(has=, hasnot=, sethas(), sethasnot()).\n  // TODO: handle and(locator), or(locator), locator(locator), locator(has=, hasnot=, sethas(), sethasnot()).\n  while (true) {\n    const hasMatch = template.match(/filter\\(,?(has=|hasnot=|sethas\\(|sethasnot\\()/);\n    if (!hasMatch)\n      break;\n\n    // Extract inner locator based on balanced parens.\n    const start = hasMatch.index! + hasMatch[0].length;\n    let balance = 0;\n    let end = start;\n    for (; end < template.length; end++) {\n      if (template[end] === '(')\n        balance++;\n      else if (template[end] === ')')\n        balance--;\n      if (balance < 0)\n        break;\n    }\n\n    // Replace Java sethas(...) and sethasnot(...) with has=... and hasnot=...\n    let prefix = template.substring(0, start);\n    let extraSymbol = 0;\n    if (['sethas(', 'sethasnot('].includes(hasMatch[1])) {\n      // Eat extra ) symbol at the end of sethas(...)\n      extraSymbol = 1;\n      prefix = prefix.replace(/sethas\\($/, 'has=').replace(/sethasnot\\($/, 'hasnot=');\n    }\n\n    const paramsCountBeforeHas = countParams(template.substring(0, start));\n    const hasTemplate = shiftParams(template.substring(start, end), paramsCountBeforeHas);\n    const paramsCountInHas = countParams(hasTemplate);\n    const hasParams = params.slice(paramsCountBeforeHas, paramsCountBeforeHas + paramsCountInHas);\n    const hasSelector = JSON.stringify(transform(hasTemplate, hasParams, testIdAttributeName));\n\n    // Replace filter(has=...) with filter(has2=$5). Use has2 to avoid matching the same filter again.\n    // Replace filter(hasnot=...) with filter(hasnot2=$5). Use hasnot2 to avoid matching the same filter again.\n    template = prefix.replace(/=$/, '2=') + `$${paramsCountBeforeHas + 1}` + shiftParams(template.substring(end + extraSymbol), paramsCountInHas - 1);\n\n    // Replace inner params with $5 value.\n    const paramsBeforeHas = params.slice(0, paramsCountBeforeHas);\n    const paramsAfterHas = params.slice(paramsCountBeforeHas + paramsCountInHas);\n    params = paramsBeforeHas.concat([{ quote: '\"', text: hasSelector }]).concat(paramsAfterHas);\n  }\n\n  // Transform to selector engines.\n  template = template\n      .replace(/\\,set([\\w]+)\\(([^)]+)\\)/g, (_, group1, group2) => ',' + group1.toLowerCase() + '=' + group2.toLowerCase())\n      .replace(/framelocator\\(([^)]+)\\)/g, '$1.internal:control=enter-frame')\n      .replace(/locator\\(([^)]+),hastext=([^),]+)\\)/g, 'locator($1).internal:has-text=$2')\n      .replace(/locator\\(([^)]+),hasnottext=([^),]+)\\)/g, 'locator($1).internal:has-not-text=$2')\n      .replace(/locator\\(([^)]+),hastext=([^),]+)\\)/g, 'locator($1).internal:has-text=$2')\n      .replace(/locator\\(([^)]+)\\)/g, '$1')\n      .replace(/getbyrole\\(([^)]+)\\)/g, 'internal:role=$1')\n      .replace(/getbytext\\(([^)]+)\\)/g, 'internal:text=$1')\n      .replace(/getbylabel\\(([^)]+)\\)/g, 'internal:label=$1')\n      .replace(/getbytestid\\(([^)]+)\\)/g, `internal:testid=[${testIdAttributeName}=$1]`)\n      .replace(/getby(placeholder|alt|title)(?:text)?\\(([^)]+)\\)/g, 'internal:attr=[$1=$2]')\n      .replace(/first(\\(\\))?/g, 'nth=0')\n      .replace(/last(\\(\\))?/g, 'nth=-1')\n      .replace(/nth\\(([^)]+)\\)/g, 'nth=$1')\n      .replace(/filter\\(,?hastext=([^)]+)\\)/g, 'internal:has-text=$1')\n      .replace(/filter\\(,?hasnottext=([^)]+)\\)/g, 'internal:has-not-text=$1')\n      .replace(/filter\\(,?has2=([^)]+)\\)/g, 'internal:has=$1')\n      .replace(/filter\\(,?hasnot2=([^)]+)\\)/g, 'internal:has-not=$1')\n      .replace(/,exact=false/g, '')\n      .replace(/,exact=true/g, 's')\n      .replace(/\\,/g, '][');\n\n  const parts = template.split('.');\n  // Turn \"internal:control=enter-frame >> nth=0\" into \"nth=0 >> internal:control=enter-frame\"\n  // because these are swapped in locators vs selectors.\n  for (let index = 0; index < parts.length - 1; index++) {\n    if (parts[index] === 'internal:control=enter-frame' && parts[index + 1].startsWith('nth=')) {\n      // Swap nth and enter-frame.\n      const [nth] = parts.splice(index, 1);\n      parts.splice(index + 1, 0, nth);\n    }\n  }\n\n  // Substitute params.\n  return parts.map(t => {\n    if (!t.startsWith('internal:') || t === 'internal:control')\n      return t.replace(/\\$(\\d+)/g, (_, ordinal) => { const param = params[+ordinal - 1]; return param.text; });\n    t = t.includes('[') ? t.replace(/\\]/, '') + ']' : t;\n    t = t\n        .replace(/(?:r)\\$(\\d+)(i)?/g, (_, ordinal, suffix) => {\n          const param = params[+ordinal - 1];\n          if (t.startsWith('internal:attr') || t.startsWith('internal:testid') || t.startsWith('internal:role'))\n            return escapeForAttributeSelector(new RegExp(param.text), false) + (suffix || '');\n          return escapeForTextSelector(new RegExp(param.text, suffix), false);\n        })\n        .replace(/\\$(\\d+)(i|s)?/g, (_, ordinal, suffix) => {\n          const param = params[+ordinal - 1];\n          if (t.startsWith('internal:has=') || t.startsWith('internal:has-not='))\n            return param.text;\n          if (t.startsWith('internal:testid'))\n            return escapeForAttributeSelector(param.text, true);\n          if (t.startsWith('internal:attr') || t.startsWith('internal:role'))\n            return escapeForAttributeSelector(param.text, suffix === 's');\n          return escapeForTextSelector(param.text, suffix === 's');\n        });\n    return t;\n  }).join(' >> ');\n}\n\nexport function locatorOrSelectorAsSelector(language: Language, locator: string, testIdAttributeName: string): string {\n  try {\n    parseSelector(locator);\n    return locator;\n  } catch (e) {\n  }\n  try {\n    const { selector, preferredQuote } = parseLocator(locator, testIdAttributeName);\n    const locators = asLocators(language, selector, undefined, undefined, preferredQuote);\n    const digest = digestForComparison(language, locator);\n    if (locators.some(candidate => digestForComparison(language, candidate) === digest))\n      return selector;\n  } catch (e) {\n  }\n  return '';\n}\n\nfunction digestForComparison(language: Language, locator: string) {\n  locator = locator.replace(/\\s/g, '');\n  if (language === 'javascript')\n    locator = locator.replace(/\\\\?[\"`]/g, '\\'');\n  return locator;\n}\n"],"mappings":"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","ignoreList":[]}