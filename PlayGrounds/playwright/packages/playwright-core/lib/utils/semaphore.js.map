{"version":3,"file":"semaphore.js","names":["_manualPromise","require","Semaphore","constructor","max","_max","_acquired","_queue","setMax","acquire","lock","ManualPromise","push","_flush","release","length","shift","resolve","exports"],"sources":["../../src/utils/semaphore.ts"],"sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ManualPromise } from './manualPromise';\n\nexport class Semaphore {\n  private _max: number;\n  private _acquired = 0;\n  private _queue: ManualPromise[] = [];\n\n  constructor(max: number) {\n    this._max = max;\n  }\n\n  setMax(max: number) {\n    this._max = max;\n  }\n\n  acquire(): Promise<void> {\n    const lock = new ManualPromise();\n    this._queue.push(lock);\n    this._flush();\n    return lock;\n  }\n\n  release() {\n    --this._acquired;\n    this._flush();\n  }\n\n  private _flush() {\n    while (this._acquired < this._max && this._queue.length) {\n      ++this._acquired;\n      this._queue.shift()!.resolve();\n    }\n  }\n}\n"],"mappings":";;;;;;AAgBA,IAAAA,cAAA,GAAAC,OAAA;AAhBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAIO,MAAMC,SAAS,CAAC;EAKrBC,WAAWA,CAACC,GAAW,EAAE;IAAA,KAJjBC,IAAI;IAAA,KACJC,SAAS,GAAG,CAAC;IAAA,KACbC,MAAM,GAAoB,EAAE;IAGlC,IAAI,CAACF,IAAI,GAAGD,GAAG;EACjB;EAEAI,MAAMA,CAACJ,GAAW,EAAE;IAClB,IAAI,CAACC,IAAI,GAAGD,GAAG;EACjB;EAEAK,OAAOA,CAAA,EAAkB;IACvB,MAAMC,IAAI,GAAG,IAAIC,4BAAa,CAAC,CAAC;IAChC,IAAI,CAACJ,MAAM,CAACK,IAAI,CAACF,IAAI,CAAC;IACtB,IAAI,CAACG,MAAM,CAAC,CAAC;IACb,OAAOH,IAAI;EACb;EAEAI,OAAOA,CAAA,EAAG;IACR,EAAE,IAAI,CAACR,SAAS;IAChB,IAAI,CAACO,MAAM,CAAC,CAAC;EACf;EAEQA,MAAMA,CAAA,EAAG;IACf,OAAO,IAAI,CAACP,SAAS,GAAG,IAAI,CAACD,IAAI,IAAI,IAAI,CAACE,MAAM,CAACQ,MAAM,EAAE;MACvD,EAAE,IAAI,CAACT,SAAS;MAChB,IAAI,CAACC,MAAM,CAACS,KAAK,CAAC,CAAC,CAAEC,OAAO,CAAC,CAAC;IAChC;EACF;AACF;AAACC,OAAA,CAAAhB,SAAA,GAAAA,SAAA","ignoreList":[]}