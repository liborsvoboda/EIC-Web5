!function(){"use strict";function e(){$=D/k.repeatNum,H=$*(re.height/re.width);for(var e=.5+je.height/2-H/2|0,t=.5+je.width/2-D/2|0,a=0;a<je.width/Re.width;a++)qe.drawImage(Re,a*Re.width,e-Re.height),qe.drawImage(xe,a*xe.width,e+H);var r=g(p(re,$,H));k.invert&&(r=m(r));for(var l=.5+je.width/2/$|0,o=-l;o<k.repeatNum+l;o++)qe.putImageData(r,t+o*$,e);Ue.drawImage(je,0,0,le.width,le.height),Ue.strokeStyle="#C60204",Ue.strokeRect(V.x[0]*G,V.y[0]*G,D*G,Q*G),i(n(k.repeatColorNum))}function t(){if(re.src){if(qe.globalAlpha=0,qe.clearRect(0,0,je.width,je.height),qe.globalAlpha=1,Ue.clearRect(0,0,le.width,le.height),he.style.visibility="visible",de.style.backgroundColor="#4FA099",ce.style.backgroundColor="#4FA099",ue.style.backgroundColor="#4FA099",se.style.backgroundColor="#4FA099",de.disabled=!1,ce.disabled=!1,ue.disabled=!1,se.disabled=!1,V||(V={},V.x=[je.width/2-D/2,je.width/2-D/2+D],V.y=[je.height/2-Q/2,je.height/2-Q/2+Q]),"repeat"===k.current)return e();re.width>re.height?($=D,H=D*(re.height/re.width)):($=Q*(re.width/re.height),H=Q);var t=.5+je.width/2-$/2|0,a=.5+je.height/2-H/2|0,r=g(p(re,$,H));k.invert&&(r=m(r)),qe.putImageData(r,t,a),Ue.drawImage(re,le.width/2-$*G/2,le.height/2-H*G/2,$*G,H*G),Ue.strokeStyle="#C60204",Ue.strokeRect(V.x[0]*G,V.y[0]*G,D*G,Q*G),i(n())}}function a(e,t){if(e=Number(e),t){var a=e/t;V.x=[V.x[0]*a,V.x[1]*a],V.y=[V.y[0]*a,V.y[1]*a]}D=e,Q=D*te,M=_/D*b,X=ee/Q*b,Y=M/2,ie.width=D*M+180*b,ie.height=Q*X+30*b,ie.style.width=_+180+"px",le.width=200,le.height=200*(Q/D),je.width=2*D,je.height=2*Q,G=le.width/je.width,K=je.width/le.width}function r(e,t){I.list[e]=t,localStorage.setItem("colors",I.list.join(",")),e===I.parts&&d(),e===I.fill&&d(),W&&i(W)}function n(e){return e=e||k.colorNum,re.src?W=k[k.current](f(qe.getImageData(V.x[0],V.y[0],D,Q),{level:k.brightness}),e):null}function i(e){var t=90*b,a=10*b;if(e){for(var r={0:[],1:[],2:[],3:[]},n=0;n<e.height;n++)for(var i=0;i<e.width;i++){var d,u=4*(i+n*e.width);d=0===e.data[u+3]?I.fill:l(e.data[u]),r[d].push([t+i*M,a+n*X,Ae,M,X,Y])}c(),Ae.lineWidth=.05;for(var s=0;s<Object.keys(r).length;s++)Ae.beginPath(),r[s].forEach(function(e){o.apply(null,e)}),Ae.fillStyle="#"+I.list[s],Ae.fill(),Ae.stroke()}}function l(e){var t;switch(e){case 85:t=1;break;case 128:t=2;break;case 170:t=2;break;case 255:t=3;break;default:t=0}return t}function o(e,t,a,r,n,i){a.moveTo(e+r/2,t+i),a.quadraticCurveTo(e+r-r/3,t-n/12,e+r-r/10,t-n/4),a.quadraticCurveTo(e+r-r/50,t,e+r-r/70,t+n/10),a.bezierCurveTo(e+r,t+n/4,e+r,t+.5*n,e+r-r/15,t+.66*n),a.bezierCurveTo(e+r-.3*r,t+n,e+r-.3*r,t+n,e+r-r/2+r/20,t+n+n/3),a.quadraticCurveTo(e+r-.55*r,t+.7*n,e+r-r/2,t+i),a.moveTo(e+r/2-.05*r,t+i),a.quadraticCurveTo(e+.4*r,t+n/12,e+r/10,t-n/4),a.quadraticCurveTo(e+r/50,t,e+r/70,t+n/10),a.bezierCurveTo(e,t+n/4,e,t+.5*n,e+r/15,t+.66*n),a.bezierCurveTo(e+.3*r,t+n,e+.3*r,t+n,e+r/2-r/20,t+n+n/3),a.quadraticCurveTo(e+.56*r,t+(n+n/4),e+r/2-.05*r,t+i)}function d(){var e=ie.width;ie.width=0,ie.width=e,Ae.beginPath(),Ae.moveTo(270*b,0*b),Ae.lineTo(250*b,10*b),Ae.quadraticCurveTo(390*b,120*b,530*b,10*b),Ae.lineTo(510*b,0*b),Ae.quadraticCurveTo(390*b,90*b,270*b,0*b),Ae.fillStyle="#"+I.list[I.parts],Ae.fill(),Ae.beginPath(),Ae.moveTo(640*b,30*b),Ae.quadraticCurveTo(635*b,140*b,670*b,290*b),Ae.lineTo(653*b,570*b),Ae.quadraticCurveTo(652*b,605*b,660*b,640*b),Ae.lineTo(730*b,640*b),Ae.bezierCurveTo(780*b,400*b,770*b,50*b,640*b,30*b),Ae.fillStyle="#"+I.list[I.parts],Ae.fill(),Ae.beginPath(),Ae.moveTo(140*b,30*b),Ae.quadraticCurveTo(145*b,140*b,122*b,280*b),Ae.lineTo(129*b,570*b),Ae.quadraticCurveTo(130*b,605*b,120*b,640*b),Ae.lineTo(50*b,640*b),Ae.bezierCurveTo(20*b,400*b,30*b,50*b,140*b,30*b),Ae.fillStyle="#"+I.list[I.parts],Ae.fill(),Ae.beginPath(),Ae.moveTo(130*b,630*b),Ae.lineTo(130*b,660*b),Ae.quadraticCurveTo(390*b,680*b,650*b,660*b),Ae.lineTo(650*b,630*b),Ae.quadraticCurveTo(390*b,650*b,130*b,630*b),Ae.fillStyle="#"+I.list[I.parts],Ae.fill(),c()}function c(){Ae.beginPath(),Ae.moveTo(250*b,10*b),Ae.lineTo(140*b,30*b),Ae.quadraticCurveTo(145*b,140*b,120*b,280*b),Ae.lineTo(130*b,630*b),Ae.quadraticCurveTo(390*b,650*b,650*b,630*b),Ae.lineTo(670*b,290*b),Ae.quadraticCurveTo(635*b,140*b,640*b,30*b),Ae.lineTo(530*b,10*b),Ae.quadraticCurveTo(390*b,120*b,250*b,10*b),Ae.fillStyle="#"+I.list[I.fill],Ae.fill(),Ae.clip()}function u(e,t){return"M "+(e+.95)+" "+(t+1)+" Q"+(e+.8)+" "+(t+.17)+" "+(e+.27)+" "+(t-.5)+" Q"+(e+.01)+" "+t+" "+(e+.02)+" "+(t+.2)+" C"+e+" "+(t+.5)+" "+e+" "+(t+1)+" "+(e+.14)+" "+(t+1.3)+" Q"+(e+.6)+" "+(t+2)+" "+(e+.87)+" "+(t+2.67)+" Q"+(e+1.1)+" "+(t+2.5)+" "+(e+.95)+" "+(t+1)+" M"+(e+1.05)+" "+(t+1)+" Q"+(e+1.2)+" "+(t+.17)+" "+(e+1.73)+" "+(t-.5)+" Q"+(e+1.99)+" "+t+" "+(e+1.98)+" "+(t+.2)+" C"+(e+2)+" "+(t+.5)+" "+(e+2)+" "+(t+1)+" "+(e+1.86)+" "+(t+1.3)+" Q"+(e+1.4)+" "+(t+2)+" "+(e+1.13)+" "+(t+2.67)+" Q"+(e+.96)+" "+(t+2.6)+" "+(e+1.05)+" "+(t+1)}function s(){var e=2,t=2,a=D*e,r=Q*t,n="#000",i="http://www.w3.org/2000/svg",o=document.createElementNS(i,"svg");o.setAttributeNS(null,"width",a),o.setAttributeNS(null,"height",r),o.setAttributeNS(null,"viewBox","0 0 "+a+" "+r);for(var d={0:[],1:[],2:[],3:[]},c=0;c<W.height;c++)for(var s=0;s<W.width;s++){var h,v=4*(s+c*W.width);h=0===W.data[v+3]?I.fill:l(W.data[v]),d[h].push([s*e,c*t])}for(var g=0;g<Object.keys(d).length;g++){var f=document.createElementNS(i,"g");f.setAttributeNS(null,"fill","#"+I.list[g]),f.setAttributeNS(null,"stroke",n),f.setAttributeNS(null,"stroke-width","0.2"),f.setAttributeNS(null,"paint-order","stroke fill markers"),d[g].forEach(function(e){var t=u.apply(null,e),a=document.createElementNS(i,"path");a.setAttributeNS(null,"d",t),f.appendChild(a)}),o.appendChild(f)}return o}function h(e){for(var t=[[0,128,32,160],[192,64,224,96],[48,176,16,144],[240,112,208,80]],a=0;a<e.height;a++)for(var r=0;r<e.width;r++){var n=4*(r+a*e.width);if(0!==e.data[n+3]){var i=e.data[n]>t[a%4][r%4]?255:0;e.data[n]=i,e.data[n+1]=i,e.data[n+2]=i,e.data[n+3]=255}}return e}function v(e,t){t=t||4;for(var a,r=e.width*e.height,n=255,i=0,l=0;l<r;l++)if(a=4*l,0!==e.data[a+3]){var o=e.data[a];o<n&&(n=o),o>i&&(i=o)}for(var d=new Uint8Array(256),c=.5+(i-n)/t|0,u=.5+256/(t-1)|0,s=0;s<t;s++)for(l=0;l<c;l++){a=n+c*s+l;var h=s*u;h>255&&(h=255),d[a]=h}for(l=a;l<256;l++)d[l]=255;for(l=0;l<r;l++)a=4*l,e.data[a]=d[e.data[a]],e.data[a+1]=d[e.data[a+1]],e.data[a+2]=d[e.data[a+2]],e.data[a+3]=e.data[a+3];return e}function g(e){function t(e,t,a){return.299*e+.587*t+.114*a}for(var a=0;a<e.width*e.height;a++){var r=4*a,n=t(e.data[r],e.data[r+1],e.data[r+2]);e.data[r]=n,e.data[r+1]=n,e.data[r+2]=n,e.data[r+3]=e.data[r+3]}return e}function f(e,t){t=t||{},t.level=t.level||0;for(var a=e.width*e.height,r=0;r<a;r++){var n=4*r;e.data[n]=e.data[n]+t.level,e.data[n+1]=e.data[n+1]+t.level,e.data[n+2]=e.data[n+2]+t.level,e.data[n+3]=e.data[n+3]}return e}function m(e){for(var t=0;t<e.data.length;t++)(t+1)%4!==0&&(e.data[t]=255-e.data[t]);return e}function p(e,t,a){var r=document.createElement("canvas");r.width=t,r.height=a;var n=r.getContext("2d");return n.drawImage(e,0,0,t,a),n.getImageData(0,0,t,a)}function y(e,t){return e>t[0]&&e<t[1]}function w(e,t){t||(t=window.location.href),e=e.replace(/[[\]]/g,"\\$&");var a=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),r=a.exec(t);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null}var b=window.devicePixelRatio,E="0",N="1",C="C60204,B02C2C,00B36B,FCFCFC",I={fill:Number(E),parts:Number(N),list:C.split(",")},k={current:"repeat",brightness:0,invert:!1,repeatNum:3,colorNum:4,repeatColorNum:2,dither:h,posterize:v,repeat:v},T=localStorage.getItem("colors"),L=localStorage.getItem("fill"),S=localStorage.getItem("parts");T&&(I.list=T.split(",")),L&&!isNaN(L)&&(I.fill=Number(L)),S&&!isNaN(S)&&(I.parts=Number(S));var B=w("mode"),x=Number(w("repeat")),R=Number(w("color")),j=w("colors"),A=w("invert"),U=Number(w("sts")),q=w("downloadmode"),z=w("svgdownload"),O={dither:"dither",posterize:"posterize",repeat:"repeat",halftone:"dither",poster:"posterize",holiday:"repeat"};if(B=O[B],x<0&&(x=null),(R<1||R>4)&&(R=null),j){j=j.split(",");for(var F=0;F<4;F++){var P=/[0-9A-F]{6}$/i.test(j[F]);P&&(I.list[F]=j[F])}}A="false"!==A&&"true"!==A?null:JSON.parse(A),z="false"!==z&&"true"!==z?null:JSON.parse(z),(isNaN(U)||U<1)&&(U=null);var D,Q,M,X,Y,$,H,J,W,G,K,V,Z,_=600,ee=660,te=ee/_,ae=new FileReader,re=new Image,ne=document.getElementById("file"),ie=document.getElementById("canvas"),le=document.getElementById("canvas-guide"),oe=document.getElementById("download-link"),de=document.getElementById("download"),ce=document.getElementById("download-pattern"),ue=document.getElementById("download-svg"),se=document.getElementById("download-wallpaper"),he=document.getElementById("canvas-guide-title"),ve=document.getElementById("guage"),ge=document.getElementById("brightness"),fe=document.getElementById("colorsize"),me=document.getElementById("repeatsize"),pe=document.getElementById("repeat-menu"),ye=document.getElementById("color0"),we=document.getElementById("color1"),be=document.getElementById("color2"),Ee=document.getElementById("color3"),Ne=document.getElementById("color-num-menu"),Ce=document.getElementsByName("fill"),Ie=document.getElementsByName("parts"),ke=document.getElementById("invert"),Te=document.getElementById("tab-dither"),Le=document.getElementById("tab-posterize"),Se=document.getElementById("tab-repeat"),Be=document.getElementById("color-reset"),xe=document.getElementById("pattern-img-bottom"),Re=document.getElementById("pattern-img-top"),je=document.createElement("canvas"),Ae=ie.getContext("2d"),Ue=le.getContext("2d"),qe=je.getContext("2d");k.brightness=Number(ge.value),k.colorNum=Number(R)||k.colorNum,k.repeatNum=Number(x)||k.repeatNum,k.current=B||k.current,"dither"===k.current?Te.checked=!0:"posterize"===k.current?(Ne.style.display="flex",Le.checked=!0):"repeat"===k.current&&(pe.style.display="flex",se.style.display="inline-block",Se.checked=!0),z&&(ue.style.display="inline-block"),me.value=k.repeatNum,fe.value=k.colorNum,ye.value=I.list[0],we.value=I.list[1],be.value=I.list[2],Ee.value=I.list[3],a(U||ve.value),(A||ke.checked)&&(k.invert=!0,ke.checked=!0),Ce.forEach(function(e){Number(e.value)===I.fill&&(e.checked=!0)}),Ie.forEach(function(e){Number(e.value)===I.parts&&(e.checked=!0)}),d(),ne.addEventListener("change",function(e){V=void 0,ae.readAsDataURL(e.target.files[0]),ae.onload=function(){re.src=ae.result,re.addEventListener("load",t,!1)}},!1),Te.addEventListener("change",function(){k.current=this.value,Ne.style.display="none",pe.style.display="none",se.style.display="none",W&&(d(),t())},!1),Le.addEventListener("change",function(){k.current=this.value,Ne.style.display="flex",pe.style.display="none",se.style.display="none",W&&(d(),t())},!1),Se.addEventListener("change",function(){k.current=this.value,Ne.style.display="none",pe.style.display="flex",se.style.display="inline-block",W&&(d(),t())},!1),ke.addEventListener("change",function(){this.checked?k.invert=!0:k.invert=!1,t()},!1),fe.addEventListener("change",function(){k.colorNum=Number(this.options[this.selectedIndex].value),t()},!1),me.addEventListener("change",function(){k.repeatNum=Number(this.options[this.selectedIndex].value),t()},!1),ge.addEventListener("change",function(){k.brightness=Number(this.value),t()},!1),ve.addEventListener("change",function(){a(this.value,D),d(),t()},!1),ye.addEventListener("change",function(){r(0,this.jscolor.toString())},!1),we.addEventListener("change",function(){r(1,this.jscolor.toString())},!1),be.addEventListener("change",function(){r(2,this.jscolor.toString())},!1),Ee.addEventListener("change",function(){r(3,this.jscolor.toString())},!1),Ce.forEach(function(e){e.addEventListener("change",function(){I.fill=Number(e.value),localStorage.setItem("fill",I.fill),d(),i(W)})},!1),Ie.forEach(function(e){e.addEventListener("change",function(){I.parts=Number(e.value),localStorage.setItem("parts",I.parts),d(),i(W)})},!1),Be.addEventListener("click",function(){var e=C.split(",");ye.jscolor.fromString(e[0]),we.jscolor.fromString(e[1]),be.jscolor.fromString(e[2]),Ee.jscolor.fromString(e[3]),I.list=e,I.fill=Number(E),I.parts=Number(N),Ce.forEach(function(e){e.value===E&&(e.checked=!0)}),Ie.forEach(function(e){e.value===N&&(e.checked=!0)}),localStorage.clear(),d(),i(W)}),le.addEventListener("mousedown",function(e){var t=e.layerX,a=e.layerY;y(t,[V.x[0]*G,V.x[1]*G])&&y(a,[V.y[0]*G,V.y[1]*G])&&(Z={x:t,y:a})},!1),le.addEventListener("mousemove",function(e){if(Z){var t=.5+(e.layerX-Z.x)*K|0,a=.5+(e.layerY-Z.y)*K|0;Z.x=e.layerX,Z.y=e.layerY,V.x=[V.x[0]+t,V.x[1]+t],V.y=[V.y[0]+a,V.y[1]+a],Ue.clearRect(0,0,le.width,le.height),"repeat"===k.current?Ue.drawImage(je,0,0,le.width,le.height):Ue.drawImage(re,le.width/2-$*G/2,le.height/2-H*G/2,$*G,H*G),Ue.strokeRect(V.x[0]*G,V.y[0]*G,D*G,Q*G)}},!1),le.addEventListener("mouseup",function(e){Z&&(Z=void 0,i(n("repeat"===k.current?k.repeatColorNum:k.colorNum)))},!1),de.addEventListener("click",function(){var e=ie;if("raw"===q){var t=document.createElement("canvas");t.width=W.width,t.width=W.height;var a=t.getContext("2d");a.putImageData(W,0,0),e=t}e.toBlob(function(e){null!==J&&window.URL.revokeObjectURL(J),J=window.URL.createObjectURL(e),oe.download="sweaterify.png",oe.href=J,oe.click()},"image/png")},!1),ce.addEventListener("click",function(){var e="data:text/csv;charset=utf-8,",t={0:0,85:1,128:2,170:2,255:3},a=["#","%","●"];a.splice(I.fill,0,"");for(var r,n=[],i=0;i<W.height;i++){r=[(i+1)%5===0?i+1:""];for(var l=0;l<W.width;l++){var o=4*(l+i*W.width);r.push(a[t[W.data[o]]])}n.push(r.join(",")+"\n")}r=[""];for(var d=0;d<W.width;d++)r.push((d+1)%5===0?d+1:"");n.push(r.join(",")+"\n"),n.splice(0,0,r.join(",")+"\n");for(var c=0;c<a.length;c++){var u=""===a[c]?"[blank]":a[c];n.splice(0,0,u+",#"+I.list[c]+"\n")}var s=encodeURI(e+n.join(""));oe.download="sweaterify-pattern.csv",oe.href=s,oe.click()},!1),ue.addEventListener("click",function(){for(var e=s(),t=(new XMLSerializer).serializeToString(e),a=t.length,r=new Uint8Array(a),n=0;n<a;n++)r[n]=t.charCodeAt(n);var i=new Blob([r],{type:"application/svg+xml"});null!==J&&window.URL.revokeObjectURL(J),J=window.URL.createObjectURL(i),oe.download="sweaterify.svg",oe.href=J,oe.click()}),se.addEventListener("click",function(){var e=1920*b,t=1200*b,a=e/t,r=document.createElement("canvas"),n=r.getContext("2d"),i=.5+Q*a|0,l=.5+(i-D)/2|0,d=k[k.current](f(qe.getImageData(V.x[0]-l,V.y[0],i,Q),{level:k.brightness}),k.repeatColorNum),c=.5+e/i|0,u=.5+t/Q|0,s=u/2;r.width=c*i,r.height=u*Q;for(var h={0:[],1:[],2:[],3:[]},v=0;v<d.height;v++)for(var g=0;g<d.width;g++){var m,p=4*(g+v*d.width);m=0===d.data[p+3]?I.fill:255===d.data[p]?3:0,h[m].push([g*c,v*u,n,c,u,s])}n.fillRect(0,0,r.width,r.height),n.lineWidth=.05;for(var y=0;y<Object.keys(h).length;y++)n.beginPath(),h[y].forEach(function(e){o.apply(null,e)}),n.fillStyle="#"+I.list[y],n.fill(),n.stroke();r.toBlob(function(e){null!==J&&window.URL.revokeObjectURL(J),J=window.URL.createObjectURL(e),oe.download="sweaterify-wallpaper.png",oe.href=J,oe.click()},"image/png")},!1),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,a){for(var r=atob(this.toDataURL(t,a).split(",")[1]),n=r.length,i=new Uint8Array(n),l=0;l<n;l++)i[l]=r.charCodeAt(l);e(new Blob([i],{type:t||"image/png"}))}})}();