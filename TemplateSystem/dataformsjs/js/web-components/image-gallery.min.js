import{loadCss}from"./utils.min.js";const shadowTmpl=document.createElement("template");shadowTmpl.innerHTML="\n    <style>\n        :host { display: block; cursor: pointer; }\n        :host([hidden]) { display: none; }\n    </style>\n    <slot></slot>\n";const svgForwardButton='<svg width="13" height="22" xmlns="http://www.w3.org/2000/svg"><path d="M3.4.6L12 9c.4.4.6 1 .6 1.5a2 2 0 01-.6 1.5l-8.5 8.5a2 2 0 01-2.8-2.8l7.2-7.2L.6 3.4A2 2 0 013.4.6z" fill="#fff" fill-rule="evenodd"/></svg>',svgBackButton='<svg width="13" height="22" xmlns="http://www.w3.org/2000/svg"><path d="M9 .6L.7 9a2 2 0 00-.6 1.5c0 .5.2 1.1.6 1.5L9 20.6a2 2 0 002.8-2.8l-7.2-7.2L12 3.4A2 2 0 009.1.6z" fill="#fff" fill-rule="evenodd"/></svg>',overlayStyleId="image-gallery-css",overlayStyleCss=`\n    body.blur { filter: blur(3px); }\n\n    .image-gallery-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background-color: rgba(255,255,255,.8);\n        cursor: pointer;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        flex-direction: column;\n    }\n\n    .image-gallery-overlay .image-gallery-loading {\n        font-weight: bold;\n        padding: 10px 20px;\n        background-color: rgba(255,255,255,.4);\n        position: absolute;\n    }\n\n    .image-gallery-overlay img {\n        max-width: 100%;\n        max-height: 100%;\n        flex-shrink: 0;\n    }\n\n    .image-gallery-overlay div {\n        position: absolute;\n        bottom: 0;\n        left: 0;\n        right: 0;\n        z-index: 2;\n        font-weight: bold;\n        display: flex;\n        justify-content: space-between;\n        width: 100%;\n    }\n\n    .image-gallery-overlay div.no-title {\n        justify-content: flex-end;\n    }\n\n    .image-gallery-overlay div span {\n        padding: 10px 20px;\n        background-color: rgba(255,255,255,.4);\n    }\n\n    .image-gallery-overlay .btn-previous,\n    .image-gallery-overlay .btn-next {\n        display: block;\n        position: absolute;\n        height: 40px;\n        width: 40px;\n        opacity: .7;\n        background-repeat: no-repeat;\n        background-position: center;\n        padding: 0;\n        margin: 15px;\n        background-color: rgba(0,0,0,.5);\n        border-radius: 50%;\n        transition: all ease-in-out .2s;\n    }\n    .image-gallery-overlay .btn-previous { left: 0; background-position-x: 12px; background-image: url("data:image/svg+xml;base64,${btoa(svgBackButton)}"); }\n    .image-gallery-overlay .btn-next { right: 0; background-position-x: 15px; background-image: url("data:image/svg+xml;base64,${btoa(svgForwardButton)}"); }\n\n    .image-gallery-overlay .btn-previous:hover,\n    .image-gallery-overlay .btn-next:hover {\n        opacity: .5;\n    }\n\n    .image-gallery-overlay.mobile .btn-previous,\n    .image-gallery-overlay.mobile .btn-next,\n    .image-gallery-overlay.keyboard .btn-previous,\n    .image-gallery-overlay.keyboard .btn-next {\n        display: none;\n    }\n\n    @media (min-width: 1300px) {\n        .image-gallery-overlay div {\n            left: calc((100% - 1300px) /2);\n            right: auto;\n            max-width: 1300px;\n        }\n    }\n`;let supportsPassive=!1;try{const e=Object.defineProperty({},"passive",{get:function(){return supportsPassive=!0,!0}});window.addEventListener("testPassive",null,e),window.removeEventListener("testPassive",null,e)}catch(e){}let images=null,imageIndex=null,imageCount=0,overlay=null,overlayImg=null,overlayTitle=null,overlayIndex=null,overlayLoading=null,overlayBackButton=null,overlayFowardButton=null,touchStartX=null,touchPinchToZoom=!1,touchPinchEndTime=null,loadingTimeoutId=null;const defaultLoadingText="Loading...",defaultLoadingTimeout=2e3,loadedImages=new Set,isMobile=(()=>{const e=window.navigator.userAgent.toLowerCase();return e.indexOf("android")>-1||e.indexOf("iphone")>-1||e.indexOf("ipad")>-1})();let startedFromKeyboard=!1,supportsAvif=null,supportsWebp=null;function checkSupportedFormats(){if(null!==supportsAvif&&null!==supportsWebp)return void showOverlay();function e(){null===supportsAvif||null===supportsWebp||showOverlay()}const n=new Image;n.onload=()=>{supportsAvif=1===n.width&&1===n.height,e()},n.onerror=()=>{supportsAvif=!1,e()},n.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABoAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACJtZGF0EgAKCBgABogQEAwgMgwYAAAAUAAAALASmpg=";const t=new Image;t.onload=()=>{supportsWebp=1===t.width&&1===t.height,e()},t.onerror=()=>{supportsWebp=!1,e()},t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA"}function showOverlay(){const e=getImage(images[imageIndex]),n=getImageTitle(images[imageIndex]),t=images[imageIndex].getAttribute("loading-text");loadCss(overlayStyleId,overlayStyleCss),overlay=document.createElement("div"),overlay.className="image-gallery-overlay"+(isMobile?" mobile":"")+(startedFromKeyboard?" keyboard":""),overlayLoading=document.createElement("span"),overlayLoading.className="image-gallery-loading",overlayLoading.textContent=t||"Loading...",overlayLoading.setAttribute("hidden",""),overlay.appendChild(overlayLoading),overlayBackButton=document.createElement("span"),overlayBackButton.className="btn-previous",overlayBackButton.setAttribute("role","button"),overlayBackButton.onclick=()=>{changeImage("left")},overlayFowardButton=document.createElement("span"),overlayFowardButton.className="btn-next",overlayFowardButton.setAttribute("role","button"),overlayFowardButton.onclick=()=>{changeImage("right")},overlay.appendChild(overlayBackButton),overlay.appendChild(overlayFowardButton),overlayImg=document.createElement("img"),overlayImg.addEventListener("load",(()=>{loadedImages.add(e),clearLoadingTimer(),null!==overlayLoading&&overlayLoading.setAttribute("hidden",""),preloadNextImages()})),overlayImg.src=e,overlay.appendChild(overlayImg);const a=document.createElement("div");overlayTitle=document.createElement("span"),overlayTitle.textContent=n,overlayTitle.style.display=n?"":"none",a.className=n?"":"no-title",a.appendChild(overlayTitle),overlayIndex=document.createElement("span"),overlayIndex.textContent=`${imageIndex+1}/${imageCount}`,a.appendChild(overlayIndex),overlay.appendChild(a),addOverlayEvents(),document.documentElement.appendChild(overlay),document.querySelector("body").classList.add("blur"),startLoadingTimer()}function getImage(e){let n=e.getAttribute("image-avif");return n&&supportsAvif?n:(n=e.getAttribute("image-webp"),n&&supportsWebp?n:e.getAttribute("image"))}function getImageTitle(e){let n=e.getAttribute("title");if(null===n){const t=e.querySelector("img[alt]");t&&(n=t.getAttribute("alt"))}return n}function startLoadingTimer(){clearLoadingTimer();const e=images[imageIndex].getAttribute("loading-timeout"),n=null===e?2e3:parseInt(e,10);loadingTimeoutId=window.setTimeout((function(){loadingTimeoutId=null,null!==overlayLoading&&overlayLoading.removeAttribute("hidden")}),n)}function clearLoadingTimer(){null!==loadingTimeoutId&&(window.clearTimeout(loadingTimeoutId),loadingTimeoutId=null)}function addOverlayEvents(){overlay.onclick=function(e){if("ontouchstart"in window){const n=window.innerHeight,t=n/4,a=n-t;if(e.clientY>=t&&e.clientY<=a)return}e.target!==overlayBackButton&&e.target!==overlayFowardButton&&hideOverlay()},document.addEventListener("keydown",handleDocKeyDown),overlay.addEventListener("touchstart",(function(e){touchStartX=e.changedTouches[0].screenX,2===e.touches.length&&(touchPinchToZoom=!0)}),!!supportsPassive&&{passive:!0}),overlay.addEventListener("touchend",(e=>{if(touchPinchToZoom)return touchPinchEndTime=new Date,void(touchPinchToZoom=!1);if(touchPinchEndTime&&(new Date).getTime()-touchPinchEndTime.getTime()<=200)return;const n=e.changedTouches[0].screenX;n>touchStartX?changeImage("left"):n<touchStartX&&changeImage("right")}))}function handleDocKeyDown(e){switch(e.key){case"ArrowLeft":changeImage("left");break;case"ArrowRight":changeImage("right");break;case"Escape":hideOverlay()}}function hideOverlay(){clearLoadingTimer(),overlay.parentNode.removeChild(overlay),overlayBackButton=null,overlayFowardButton=null,overlayLoading=null,overlayIndex=null,overlayTitle=null,overlayImg=null,overlay=null,startedFromKeyboard=!1,document.removeEventListener("keydown",handleDocKeyDown),document.querySelector("body").classList.remove("blur")}function preloadNextImages(){let e=imageIndex-1;if(-1===e&&(e=imageCount-1),e!==imageIndex){const n=getImage(images[e]);if(n&&!loadedImages.has(n)){const e=new Image;e.onload=()=>{loadedImages.add(n)},e.src=n}}let n=imageIndex+1;if(n===imageCount&&(n=0),n!==imageIndex){const e=getImage(images[n]);if(e&&!loadedImages.has(e)){const n=new Image;n.onload=()=>{loadedImages.add(e)},n.src=e}}}function changeImage(e){imageIndex="right"===e?imageIndex===imageCount-1?0:imageIndex+1:0===imageIndex?imageCount-1:imageIndex-1;const n=getImageTitle(images[imageIndex]);overlayImg.src="",overlayImg.src=getImage(images[imageIndex]),overlayTitle.textContent=n,overlayTitle.style.display=n?"":"none",overlayTitle.parentNode.className=n?"":"no-title",overlayIndex.textContent=`${imageIndex+1}/${imageCount}`,startLoadingTimer()}window.customElements.define("image-gallery",class extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"}).appendChild(shadowTmpl.content.cloneNode(!0)),this.addEventListener("click",this.handleClick),this.addEventListener("keydown",this.handleKeyDown)}handleKeyDown(e){" "===e.key&&(null===overlay&&(startedFromKeyboard=!0,this.handleClick()),e.preventDefault())}handleClick(){null!==this.getAttribute("image")?(images=document.querySelectorAll("image-gallery[image]"),imageIndex=Array.from(images).indexOf(this),imageCount=images.length,checkSupportedFormats()):console.error("Unable to view large image because <image-gallery> attribute [image] is missing.")}});