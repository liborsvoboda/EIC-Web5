import{isDomAttached,defineExtendsPolyfill}from"./utils.min.js";class InputFilter extends HTMLInputElement{constructor(){super(),this.addEventListener("input",this.filter),this.interval=null}connectedCallback(){this.setupFilter()}disconnectedCallback(){null!==this.interval&&window.clearInterval(this.interval)}setupFilter(){if(!this.hasAttribute("filter-results-selector"))return void this.filter();let t=this.parentElement;for(;t&&"JSON-DATA"!==t.nodeName;)t=t.parentElement;let e=0;this.interval=window.setInterval((()=>{if(t&&!0===t.isLoading)return;const{elements:l}=this.getElementsToFilter();0===l.length&&e<10?e++:(window.clearInterval(this.interval),this.interval=null,isDomAttached(this)&&this.filter())}),100)}getElementsToFilter(){let t=null,e=null,l=document.querySelectorAll(this.getAttribute("filter-selector"));if(1===l.length&&"TABLE"===l[0].tagName){const r=l[0];switch(r.tBodies.length){case 0:l=[];break;case 1:l=r.tBodies[0].rows,t=r.getAttribute("data-sort-class-odd"),e=r.getAttribute("data-sort-class-even");break;default:console.warn("Unexpected Table format for Filter Plugin. Only 1 <tbody> element is supported.")}}return{elements:l,cssOdd:t,cssEven:e}}filter(){const t=this.value.toLowerCase().split(" "),e=t.length,l=0!==e;let r=0;const{elements:s,cssOdd:i,cssEven:n}=this.getElementsToFilter(),o=n&&i;for(const u of s){let s=!0;if(l){let l=u.textContent;const r=u.getAttribute("data-filter-search-text");null!==r&&(l=r),l=l.toLowerCase();for(let r=0;r<e;r++)if(""!==t[r]&&!l.includes(t[r])){s=!1;break}}s&&(r++,o&&(r%2==0?(u.classList.add(n),u.classList.remove(i)):(u.classList.add(i),u.classList.remove(n)))),u.style.display=s?"":"none"}const u=this.getAttribute("filter-results-selector");if(u){const t=document.querySelector(u);if(!t)return void console.warn("Defined [filter-results-selector] but element not found");const e=this.getAttribute("filter-results-text-all"),l=this.getAttribute("filter-results-text-filtered");if(!e)return void console.warn("Defined [filter-results-selector] without [filter-results-text-all]");if(!l)return void console.warn("Defined [filter-results-selector] without [filter-results-text-filtered]");let i;const n=s.length;i=r===n?e:l.replace(/{displayCount}/g,r),i=i.replace(/{totalCount}/g,n);const o=document.querySelector("url-router");o&&"object"==typeof o.currentUrlParams&&(i=i.replace(/{(.+)}/g,(function(t,e){return void 0!==o.currentUrlParams[e]?String(o.currentUrlParams[e]):t}))),t.textContent=i}}}window.customElements.define("input-filter",InputFilter,{extends:"input"}),defineExtendsPolyfill("input-filter","input",(t=>{t.hasAttribute("data-polyfill-is-setup")||(t.addEventListener("input",InputFilter.prototype.filter.bind(t)),t.setupFilter=InputFilter.prototype.setupFilter.bind(t),t.getElementsToFilter=InputFilter.prototype.getElementsToFilter.bind(t),t.filter=InputFilter.prototype.filter.bind(t),t.setupFilter(),t.setAttribute("data-polyfill-is-setup",""))}));