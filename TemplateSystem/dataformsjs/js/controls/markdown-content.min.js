!function(){"use strict";var s=!1;function c(t,e){if(void 0===window.hljs)return s?t:"";if(e&&hljs.getLanguage(e))try{return hljs.highlight(e,t).value}catch(t){console.warn(t)}try{return hljs.highlightAuto(t).value}catch(t){console.warn(t)}return s?t:""}var l=[];var d={data:{bind:null,content:null,url:null,loadingSelector:null,showSource:!1,errorMessage:null,linkTarget:null,linkRel:null,linkRootUrl:null,loadOnlyOnce:!1,useRootUrl:!0},onLoad:function(t,e){var r;void 0===Object.getOwnPropertyDescriptor(t,"url")&&(Object.defineProperty(t,"url",{get:function(){return this.getAttribute("data-url")},set:function(t){this.url!==t&&(this.setAttribute("data-url",t),app.loadJsControl(this))}}),Object.defineProperty(t,"showSource",{get:function(){return this.hasAttribute("data-show-source")},set:function(t){this.showSource!==t&&(t?this.setAttribute("data-show-source",""):this.removeAttribute("data-show-source"),app.loadJsControl(this))}}),Object.defineProperty(t,"value",{get:function(){return this.getAttribute("data-content")},set:function(t){this.value!==t&&(""===t?this.removeAttribute("data-content"):this.setAttribute("data-content",t),app.loadJsControl(this))}}),t.clearContent=function(){t.innerHTML="",d.dispatchRendered(t)}),this.url?d.fetch.call(this,t):((r=t.querySelector('script[type="text/markdown"]'))?this.content=r.innerHTML:this.bind&&(this.content=e&&e[this.bind]?e[this.bind]:null,null===this.content&&void 0!==app.plugins.dataBind&&"function"==typeof app.plugins.dataBind.getBindValue&&(this.content=app.plugins.dataBind.getBindValue(this.bind,e))),d.render.call(this,t))},dispatchRendered:function(t){var e,r="app:markdownRendered";"function"==typeof Event?e=new Event(r,{bubbles:!0}):(e=document.createEvent("Event")).initEvent(r,!0,!1),t.dispatchEvent(e)},fetch:function(e){if(this.loadOnlyOnce){var t=function(t){for(var e=0,r=l.length;e<r;e++)if(t===l[e].url)return l[e];return null}(this.url);if(t)return this.content=t.content,this.errorMessage=t.errorMessage,void d.render.call(this,e)}this.loadingSelector&&((t=document.querySelector(this.loadingSelector))?e.innerHTML=t.innerHTML:console.warn('Could not find template from <markdown-content [loading-selector="'+this.loadingSelector+'"]>.'));var i=this,a=this.url;app.fetch(a,null,"text/plain").then(function(t){i.content=t,i.errorMessage=null,d.render.call(i,e)}).catch(function(t){i.errorMessage="Error loading markdown content from ["+a+"]. Error: "+t,d.render.call(i,e)}).finally(function(){if(i.loadOnlyOnce){var t=a,e=i.content,r=i.errorMessage;100<l.length&&(l.length=0);for(var n=0,o=l.length;n<o;n++)if(t===l[n].url)return;l.push({url:t,content:e,errorMessage:r})}})},render:function(t){if(this.errorMessage)return app.showError(t,this.errorMessage),void d.dispatchRendered(t);if(null!==this.content){var e=t.querySelector('script[type="text/markdown"]');if(e&&e.parentNode.removeChild(e),this.showSource)return t.innerHTML="<pre></pre>",t.querySelector("pre").textContent=this.content,e&&t.appendChild(e),void d.dispatchRendered(t);if(s=!1,window.marked)s=!0,marked.setOptions({highlight:c}),o=marked.marked&&marked.marked.parse?marked.marked.parse(this.content):marked(this.content);else if(window.markdownit)r=markdownit({html:!0,linkify:!0,typographer:!0,highlight:c}),window.markdownitEmoji&&r.use(markdownitEmoji),o=r.render(this.content);else{if(!window.remarkable)return app.showError(t,"Error - Unable to show Markdown content because a Markdown JavaScript library was not found on the page."),void d.dispatchRendered(t);o=(r=new remarkable.Remarkable({html:!0,typographer:!0,highlight:c}).use(remarkable.linkify)).render(this.content)}void 0!==window.DOMPurify&&(o=DOMPurify.sanitize(o)),t.innerHTML=o,e&&t.appendChild(e),void 0!==window.hljs&&(r=t.querySelectorAll('code[class*="language-"]'),Array.prototype.forEach.call(r,function(t){t.classList.add("hljs")}));var r,n,o,i,a=this.linkTarget,l=this.linkRel;(a||l)&&(o=t.querySelectorAll("a"),Array.prototype.forEach.call(o,function(t){t.target=a||t.target,t.rel=l||t.rel})),!1!==this.useRootUrl&&((e=this.url)&&(r=e.split("/"),n=e.substring(0,e.length-r[r.length-1].length)),(i=(i=this.linkRootUrl)||n)&&(o=t.querySelectorAll('a:not([href^="http:"]):not([href^="https:"])'),Array.prototype.forEach.call(o,function(t){var e=t.getAttribute("href");t.setAttribute("data-original-href",e),t.setAttribute("href",i+e)})),e=t.querySelectorAll('img:not([src^="http:"]):not([src^="https:"])'),Array.prototype.forEach.call(e,function(t){var e=t.getAttribute("src");t.setAttribute("data-original-src",e),t.setAttribute("src",n+e)})),d.dispatchRendered(t)}else t.innerHTML=""}};app.addControl("markdown-content",d).loadCss("dataformsjs-control-markdown-content","markdown-content[data-control] { display:block; }")}();