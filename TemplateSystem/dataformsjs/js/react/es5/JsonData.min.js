!function(){"use strict";var i=void 0===window.React&&void 0!==window.preact?window.preact:window.React;function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){if(t=t,!(null!=(e=e)&&"undefined"!=typeof Symbol&&e[Symbol.hasInstance]?e[Symbol.hasInstance](t):t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function u(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=p(r),e=(t=n?(t=p(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments),this);if(t&&("object"===o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return h(e)}}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var l=[],f={};function d(t){return 0===t.fetchState&&t.children?t.children:null}function y(t){if(!(-1===t.fetchState)||!t.children)return null;var e=t.error;return"string"==typeof e&&-1===e.indexOf("Error")&&(e="Error - "+e),i.cloneElement(t.children,{error:e})}function v(t){return 1===t.fetchState&&t.children?i.cloneElement(t.children,{data:t.data,params:t.params,handleChange:t.handleChange,childProps:t.childProps}):null}var t=function(t){var e=o;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t);var r,n=u(o);function o(t){var e;return a(this,o),(e=n.call(this,t))._isFetching=!1,e._isMounted=!1,e.fetchData=e.fetchData.bind(h(e)),e.handleChange=e.handleChange.bind(h(e)),e._querySrc=t&&t.querySrc?t.querySrc:void 0,e._query=t&&t.query?t.query:void 0,e.state={fetchState:0,error:null,params:e.getUrlParams(),data:null},e}return e=o,(t=[{key:"getUrlParams",value:function(){var t,e={};if(this.props&&!0===this.props.graphQL)return void 0===this.props.variables?{}:this.props.variables;for(t in this.props)"url"!==t&&"string"==typeof this.props[t]&&(e[t]=this.props[t]);return e}},{key:"componentDidMount",value:function(){if((this._isMounted=!0)===this.props.graphQL&&void 0===this._query&&void 0!==this._querySrc&&void 0!==f[this._querySrc]&&(this._query=f[this._querySrc]),this.props.loadOnlyOnce){var t=function(t,e,r){for(var n=0,o=l.length;n<o;n++){var i=l[n];if(i.url===t&&i.query===e){if(JSON.stringify(r)===i.params)return i.data;break}}return null}(this.props.url,this._query,this.getUrlParams());if(null!==t)return void this.setState({fetchState:1,data:t})}var e,r;if(!0===this.props.graphQL&&void 0===this._query&&void 0!==this._querySrc)return e=this._querySrc,r=this,void fetch(e,null).then(function(t){var e=t.status;return 200<=e&&e<300||304===e?Promise.resolve(t):(e="Error loading data. Server Response Code: "+e+", Response Text: "+t.statusText,Promise.reject(e))}).then(function(t){return t.text()}).then(function(t){f[e]=t,r._query=f[e],r.fetchData()}).catch(function(t){throw new Error("Error Downloading GraphQL Script: ["+e+"], Error: "+t.toString())});this.fetchData()}},{key:"componentDidUpdate",value:function(t,e){(!0===this.props.graphQL?JSON.stringify(t.variables)!==JSON.stringify(this.props.variables):this.buildUrl(e.params)!==this.buildUrl(this.props))&&this.setState({params:this.getUrlParams()},this.fetchData)}},{key:"componentWillUnmount",value:function(){this._isMounted=!1}},{key:"buildUrl",value:function(t){var e=this.props.url;if(!0!==this.props.graphQL&&0<Object.keys(t).length)for(var r in t)-1<e.indexOf(":"+r)&&(e=e.replace(new RegExp(":"+r,"g"),encodeURIComponent(t[r])));return e}},{key:"fetchData",value:function(){var t,e,h=this,r=this.buildUrl(this.state.params);this._isFetching||(this._isFetching=!0,t={mode:"cors",cache:"no-store",credentials:"same-origin"},this.props.fetchOptions&&(t=this.props.fetchOptions),this.props.fetchHeaders&&(t.headers=this.props.fetchHeaders),!0===this.props.graphQL&&(e=void 0===this.props.variables?{}:this.props.variables,"file://"===window.location.origin||"null"===window.location.origin?r=(r=(r+=-1===r.indexOf("?")?"?":"&")+"query="+encodeURIComponent(this._query.trim()))+"&variables="+encodeURIComponent(JSON.stringify(e)):(t.method="POST",void 0===t.headers?t.headers={"Content-Type":"application/json"}:t.headers["Content-Type"]="application/json",t.body=JSON.stringify({query:this._query,variables:e}))),this.setState({fetchState:0},function(){h.updateView(),fetch(r,t).then(function(t){var e=t.status;return 200<=e&&e<300||304===e?Promise.resolve(t):(e="Error loading data. Server Response Code: "+e+", Response Text: "+t.statusText,Promise.reject(e))}).then(function(t){return t.json()}).then(function(t){var e,r=!0===h.props.graphQL;if(r&&(t.errors&&t.errors.length))throw e=1===t.errors.length&&t.errors[0].message?"[GraphQL Error]: "+t.errors[0].message:("string"==typeof h.props.errorTextGraphQLErrors?h.props.errorTextGraphQLErrors:"{count} GraphQL Errors occurred. See console for full details.").replace("{count}",t.errors.length),console.error(t.errors),e;if(h._isMounted&&h.setState({fetchState:1,data:r?t.data:t}),h.props.loadOnlyOnce){for(var n=h.props.url,o=h._query,i=h.getUrlParams(),a=r?t.data:t,s=0,c=l.length;s<c;s++){var u=l[s];if(u.url===n&&u.query===o)return void(u.params=JSON.stringify(i),u.data=a)}l.push({url:n,query:o,params:JSON.stringify(i),data:a})}}).catch(function(t){h._isMounted&&h.setState({fetchState:-1,error:t.toString()})}).finally(function(){h._isFetching=!1,h.updateView()})}))}},{key:"handleChange",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;this._isMounted&&this.setState({data:null===t?this.state.data:t})}},{key:"updateView",value:function(){if("function"==typeof this.props.onViewUpdated)try{this.props.onViewUpdated()}catch(t){console.error(t)}}},{key:"render",value:function(){return i.createElement(i.Fragment,null,i.createElement(d,{fetchState:this.state.fetchState},this.props.isLoading),i.createElement(y,{fetchState:this.state.fetchState,error:this.state.error},this.props.hasError),i.createElement(v,{fetchState:this.state.fetchState,data:this.state.data,params:this.state.params,handleChange:this.handleChange,childProps:this.props.childProps},this.props.isLoaded))}}])&&s(e.prototype,t),r&&s(e,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(i.Component);window.JsonData=t}();